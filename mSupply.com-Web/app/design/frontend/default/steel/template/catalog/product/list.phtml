<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Category view template
 *
 * @see Mage_Catalog_Block_Category_View
 */

 $products = Mage::getModel('catalog/category')->load(282)
 ->getProductCollection()
 ->addAttributeToSelect('*')
 ->addAttributeToFilter('status', 1)
 ->addAttributeToFilter('visibility', 4)
 ->setOrder('price', 'ASC')
 ;
 $attributeCode = 'diameter';
$manufacturer = 'manufacturer';
$usedAttributeValues = array();
$usedAttributeValues1 = array();

?>
<?php 
$brandurl = $_GET['catid']; 
if($brandurl == '')
{
	$brandurl = 0;
}else{
	$brandurl = $_GET['catid']; 
}
?>
<?php 


 foreach($products as $product)
       {
		   $usedAttributeValues[$product->getData($attributeCode)] = $product->getAttributeText($attributeCode);
		   $usedAttributeValues1[$product->getData($manufacturer)] = $product->getAttributeText($manufacturer);
       }
	    $usedAttributeValues = array_unique($usedAttributeValues);
		$usedAttributeValues = json_encode($usedAttributeValues);
		$usedAttributeValues11 = array_unique($usedAttributeValues1);
	    $usedAttributeValues1 = json_encode($usedAttributeValues11);
	   ?>

<script type="text/javascript">
jQuery.noConflict();
jQuery(document).ready(function($) {
    var showChar = 100;
    var ellipsestext = "...";
    var moretext = "READ MORE";
    var lesstext = "LESS";
    jQuery('.more').each(function() {
        var content = jQuery(this).html();
 
        if(content.length > showChar) {
 
            var c = content.substr(0, showChar);
            var h = content.substr(showChar-1, content.length - showChar);
 
            var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';
 
            jQuery(this).html(html);
        }
 
    });
 
    jQuery(".morelink").click(function(){
        if(jQuery(this).hasClass("less")) {
            jQuery(this).removeClass("less");
           jQuery(this).html(moretext);
        } else {
            jQuery(this).addClass("less");
            jQuery(this).html(lesstext);
        }
        jQuery(this).parent().prev().toggle();
        jQuery(this).prev().toggle();
        return false;
    });
});

</script> 
<script type="text/javascript">
  jQuery(document).ready(function() {
 	 jQuery('.list_enabled:first input').attr('checked', 'checked');
  });
</script> 
<div class="spin-wrapper" style="display:none;"><div class="spinner"></div></div>
<!-- new code-->
<div class="wrapper-container">
<!-- left side-->
<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 rpad0">
<div class="well-block mb0">
<div class="steelheading">TMT Steel</div>
<div class="stl-img"><img class="img-responsive" src="<?php echo $this->getSkinUrl('images/steelimg.jpg'); ?>" alt="steel"></div>
<div class="comment">
    TMT steel i.e. Thermo Mechanically Treated (TMT) steel is a type of steel that goes through a special heat treatment process. This process ensures greater strength and allows for enhanced bending and welding. TMT steel is usually available in rods of fixed sizes. These rods are used to impart strength to a structure.
</div>
</div><!-- well block end-->
<div class="well-block-share">
	<div class="sharepdt">
	<h5><span class="fa fa-share-alt "></span>Share this product</h5>
	<!--<div class=" col-lg-12 mt1em">
	<a target="_blank" href="https://plus.google.com/+mSupplydotcom/posts"><i class="fa fa-google-plus-square gplus"></i></a>

	<a target="_blank" href="https://www.facebook.com/mSupplydotcom/"><i class="fa fa-facebook-square fbshare"></i></a>

	<a target="_blank" href="https://twitter.com/mSupplydotcom/"><i class="fa fa-twitter-square twiitershare"></i></a>

	<a target="_blank" href="https://in.pinterest.com/msupplydotcom/"><i class="fa fa-pinterest-square pinshare"></i></a>
	</div>	-->
	<div class=" col-lg-12 mt1em pad0">
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_pinterest_large' displayText='Pinterest'></span>
</div>

<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "31365615-d6b2-45ef-80f4-958b449754af", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>	
	</div>
</div><!-- well block end-->
</div>
<!-- left side end-->
<!-- right side-->
<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">
<!-- choose brand-->
<div class="well-block">
  <div class="cbheading" id="cbheading">Choose a Brand</div>
  <div class="syellowline"></div>
  <div class="row clear">
<?php 
asort($usedAttributeValues11);
 foreach($usedAttributeValues11 as $key => $value)
		{ 
		if($value != ''){
			
		?>
						   
						   
  <div class="col-lg-2 col-xs-6 col-sm-4 col-md-3 mcbrand list_enabled">
    <input type="radio" class="brand_list" name="brand" id="deal<?php echo $key; ?>" value="<?php echo $key; ?>"><span class="mbrandname"><?php echo $value; ?></span>
  </div>

  <?php
		}  
  } ?>
  </div>
</div><!-- well block end-->
<!-- choose brand end-->
<!-- select steel-->

<div class="well-block mb0">

		<div class="row">
			<div class="col-lg-3">
				<div class="cbheading">Select TMT Steel:</div>
				<div class="syellowline"></div>
			</div>
			<div class="col-lg-9">
			<div class="switch_type" style="display:none;">Please enter valid quantity</div>
			<div class="switch_type1" id="nosellers" style="display:none;">Sorry there are no sellers serving this locality right now - please try different zip code in Check Availability.</div>
			</div>
		</div>

	<div class="list col-lg-12 pad0 mt1em"><!--select product start-->
	</div>
	<form type="post" action="<?php echo $this->getUrl('feedback/index/bulkaddtocart'); ?>" id="addtocartForm">	
		<input type="hidden" name="select_product" id="select_product" value="">
		<input type="hidden" name="input_type" id="input_type" value="">
		<div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 text-right"><div class="moq-qty-msg"></div></div>
		<div class="row">
		
			<div class="col-lg-8 col-xs-12 col-md-6 col-sm-12 mt10"><div class="weightmsg">Please note there could be weighment variance of +/- 0.5% between any two weighbridge.</div></div>
			<div class="submit_area" id="submit_cart">
				<!--<div class="col-lg-2 col-xs-12 col-md-3 col-sm-6 mt10" id="buynow_action" ><button type="button" value="Buy Now" class="buy_now sbuynowbtn sbuynowbtns" id="addalltocart_buynow">Buy Now</button></div>-->
				<div class="col-lg-2 col-xs-12 col-md-3 col-sm-6 mt10 pull-right" id="add_to_cart_action"><button type="button" class="add_cart saddtocartbtn saddtocartbtns" id="addalltocart">Add to List</button></div>
			</div>
		</div>
	</form>
</div><!-- well block end-->


<?php echo $this->getChildHtml('recently_viewed') ?>

<style>   .moq-qty-msg{ color: rgb(191, 74, 50); font-size:12px;}.steelbntable , .steelmttable { margin-bottom:10px !important;}</style>
<!-- select steel end-->
 <!-- seller block-->
        
		 
							<div class="seller_choosen" id="seller_choosen">
							<div class="well-block-seller">
								<div class="clearfix"></div>
								<div class="pdt-rthead col-lg-12 col-md-12 col-sm-12 col-xs-12">Seller</div>
								<div class="row">
									<div class="col-lg-8 col-sm-8 col-md-8 ol-xs-12">
										
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 top-selname"><h4>-</h4></div>
										<div class="totalseller col-lg-12 col-md-12 col-sm-12 col-xs-12"><a id="totalseller"></a></div>
										
									</div>
									<div class="col-lg-4 col-sm-4 col-md-4 ol-xs-12 text-right">
										
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 top-del-pc"><h4>Delivery Pincode: <span id="current_pincode">-</span></h4></div>
										
										<div class="totalseller col-lg-12 col-md-12 col-sm-12 col-xs-12"><a id="pincode_change">Change</a></div>
									</div>
								</div><!-- row end-->
							</div>
</div>

<style>
.pdt-rthead {
    background: #f8f8f8;
    padding: 10px 15px;
    margin-bottom: 10px;
    color: #BD4931;
}
.top-selname h4 {
    color: #444;
    font-size: 15px;
	font-weight:bold;
}
.top-del-pc h4{ font-size:15px;}
.top-del-pc span{ color: #444;font-weight:bold;}
.totalseller a {
    color: rgb(191, 74, 50);
    font-size: 13px;
    text-decoration: underline;
    text-transform: uppercase;
	    font-weight: bold;
    letter-spacing: 1px;
}
</style>


</div><!-- right side end-->

<!-- choose seller-->
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

<div class="well-block" id="seller-result">
<div class="csheading">Choose Seller</div>
<div class="col-lg-12 rcustomline"><div class="csyellowline"></div></div>
			<div class="area_pin"><!--area_pin start-->
				<div class="row mb1em">
					<div class="col-lg-5 col-xs-12 col-md-6 col-sm-8 mt3em">
						<div class="row">
							<div class="col-lg-4 col-sm-6 col-xs-12 text-left mt10 rcheckavail">
								<span class="glyphicon glyphicon-map-marker stlyellow mr10"></span><span>Check Availability</span>
							</div>
							<div class="col-lg-6 col-sm-6 col-xs-12 pad0 rcustompad">
							<div class="input-group customzipcode">

								<input type="text" name="zip_input" value="<?php $session = Mage::getSingleton("core/session",  array("name"=>"frontend"));
                                       $zip = $session->getData("zip"); 
                                       echo $zip;
                                 ?>" class="pin_input form-control" id="zip_input" placeholder="Enter Pincode">
								<span class="input-group-addon"><input type="submit" id="search_by_zip" class="stlzip customgo" name="search_by_zip" value="CHECK"></span>
							</div>
							<div class="errmsg clearfix"  id="errmsg clearfix"></div>
						</div>
						</div>
					</div><!-- col-4 end-->
					
					
					<div class="col-lg-2 col-xs-12 col-md-3 col-sm-4 mt3em">
					<a id="OpenDialog" href="javascript:void()" onclick="showDialog();" class="compare_brand sbuynowbtn" style="display:none;">Compare Brands</a>
					</div>
			<div class="col-lg-5 col-xs-12 col-md-5 col-sm-5 mt3em text-right listseller-count" style="display:none;">
						<div class="slrmsg"><span class="sellercount"></span> Seller(s) found in Pincode <span class="ziplist"></span></div>
						
					</div>
			
			</div><!-- row end-->
			</div><!--area_pin end-->
		
			
			
			
			<div class="select_seller"><!--select_seller start-->

				

			</div><!--select_seller start-->
			
			<!--Compare Brands start-->
			
			
			
			<div id="dialog" style="display:none;">
				<div class="compare_area">
						
			    
				</div>
			</div>
	


		



			
		   <!--Compare Brands end-->
			
	


</div><!-- well block end-->

</div><!-- choose seller end-->





</div><!-- wrapper end-->

<script>
jQuery("#pincode_change").click(function(e){
	e.preventDefault();
	jQuery('html, body').animate({
		scrollTop: jQuery("#seller-result").offset().top
	}, 800);
	jQuery("#zip_input").focus();
});
jQuery("#totalseller").click(function(e){
	e.preventDefault();
	jQuery('html, body').animate({
		scrollTop: jQuery("#seller-result").offset().top
		}, 800);
});
jQuery("#addalltocart").click(function(){
	if(jQuery('.box').is(':checked'))
	{
	if(jQuery('#zip_input').val() != '')
	{ 			
	if(jQuery('.clickmetoselect1').is(':checked'))
	{	
		var exitSubmit = false;
		jQuery('.box:checked').each(function(){
		var x1 = jQuery(this).parent().parent().find('.quantity-box input').val(); 
		if(x1 == 0.00 || x1 == 0 || x1 == ''){	
			//alert(hasErr);
			exitSubmit = true;
			return false;
		}
		});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
		var moqapi = jQuery('input[name=vendor]:checked').attr('moq');
	var tp_of = jQuery('#menu1').text();
	if(tp_of == 'MT'){
		var zipqty = jQuery('#tquantity').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi +' MT';
	}else if(tp_of == 'Kg'){
		var zipqty = jQuery('#testimate').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi*1000 +' Kg';
	}else{
		var zipqty = jQuery('#testimate').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi +' MT';
	}		
	if(Number(zipqty) < Number(moqapi) ){
		jQuery('.moq-qty-msg').show();
		jQuery('.moq-qty-msg').text(moqmsg);
	}else{
		jQuery('#add_to_cart_action button').hide();
		jQuery('#buynow_action button').hide();
		jQuery('#submit_cart').html('Please Wait....');
	var output = jQuery.map(jQuery(':checkbox[name=pid\\[\\]]:checked'), function (n, i) {
		return n.value;
	}).join(', ');
	jQuery('#select_product').val(output);
	jQuery('#input_type').val("cart");
	jQuery('#addtocartForm').submit(); 
	}
	}
	}else if(jQuery('tr').hasClass('clickmetoselect'))
	{
		alert("Please select any seller.");
	}
	else
	{
	var exitSubmit = false;
	jQuery('.box:checked').each(function(){
		var x1 = jQuery(this).parent().parent().find('.quantity-box input').val();
		if(x1 == 0.00 || x1 == 0 || x1 == ''){	
			//alert(hasErr);
			exitSubmit = true;
			return false;
			//alert('please enter quantity which you selected products');
			//return false;
		}
	});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
	if(jQuery('#zip_input').val() == '')
	{ 		
		alert("Sorry there are no sellers serving this locality right now - please check again in few days.");
	}else{
	var noseller = jQuery('.select_seller p').text();
	if(noseller == 'Sorry there are no sellers serving this locality right now - please check again in few days.'){
		alert("Sorry there are no sellers serving this locality right now - please check again in few days.");
	}else{
	//alert('please click on go button to choose seller');
	var r = confirm("please click on Ok button to choose seller");
	if (r == true) {
		jQuery('#search_by_zip').trigger('click');
	} 
	}
	}
	}
	}
	}
	else
	{
	var exitSubmit = false;
	jQuery('.box:checked').each(function(){
	var x1 = jQuery(this).parent().parent().find('.quantity-box input').val();
	if(x1 == 0.00 || x1 == 0 || x1 == ''){	
		exitSubmit = true;
		return false;
	}
	});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
		alert("Please enter your pincode")	
	}
	}	
	}
	else
	{
		alert("Please select any product.")
	}					
});

jQuery("#addalltocart_buynow").click(function(){	
	if(jQuery('.box').is(':checked'))
	{
	if(jQuery('#zip_input').val() != '')
	{ 			
	if(jQuery('.clickmetoselect1').is(':checked'))
	{	
		var exitSubmit = false;
		jQuery('.box:checked').each(function(){
		var x1 = jQuery(this).parent().parent().find('.quantity-box input').val(); 
		if(x1 == 0.00 || x1 == 0 || x1 == ''){	
			exitSubmit = true;
			return false;
		}
		});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
	var moqapi = jQuery('input[name=vendor]:checked').attr('moq');
	var tp_of = jQuery('#menu1').text();
	if(tp_of == 'MT'){
		var zipqty = jQuery('.quantity').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi +' MT';
	}else if(tp_of == 'Kg'){
		var zipqty = jQuery('.estimate').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi*1000 +' Kg';
	}else{
		var zipqty = jQuery('.estimate').text();
		var moqmsg = 'Minimum Order Quantity for this Seller is '+ moqapi +' MT';
	}		
	
	if(zipqty < moqapi ){
		jQuery('.moq-qty-msg').show();
		jQuery('.moq-qty-msg').text(moqmsg);
	}else{
		jQuery('#add_to_cart_action button').hide();
		jQuery('#buynow_action button').hide();
		jQuery('#submit_cart').html('Please Wait....');
		var output = jQuery.map(jQuery(':checkbox[name=pid\\[\\]]:checked'), function (n, i) {
		return n.value;
	}).join(', ');
	jQuery('#select_product').val(output);
	jQuery('#input_type').val("checkout");
	jQuery('#addtocartForm').submit();
	}
	}
	}else if(jQuery('tr').hasClass('clickmetoselect'))
	{
		alert("Please select any seller.")
	}
	else
	{
	var exitSubmit = false;
	jQuery('.box:checked').each(function(){
		var x1 = jQuery(this).parent().parent().find('.quantity-box input').val();
		if(x1 == 0.00 || x1 == 0 || x1 == ''){	
			exitSubmit = true;
			return false;
		}
	});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
	if(jQuery('#zip_input').val() == '')
	{ 		
		alert("Sorry there are no sellers serving this locality right now - please check again in few days.");
	}else{
	var noseller = jQuery('.select_seller p').text();
	if(noseller == 'Sorry there are no sellers serving this locality right now - please check again in few days.'){
		alert("Sorry there are no sellers serving this locality right now - please check again in few days.");
	}else{
	var r = confirm("please click on Ok button to choose seller");
	if (r == true) {
		jQuery('#search_by_zip').trigger('click');
	} 
	}
	}
	}
	}
	}
	else
	{
	var exitSubmit = false;
	jQuery('.box:checked').each(function(){
		var x1 = jQuery(this).parent().parent().find('.quantity-box input').val();
		if(x1 == 0.00 || x1 == 0){	
			//alert(hasErr);
			exitSubmit = true;
			return false;
			//alert('please enter quantity which you selected products');
			//return false;
		}
	});
	if(exitSubmit){
		alert('please enter quantity for selected products');
	}else{
		alert("Please enter your pincode")	
	}
	}	
	}
	else
	{
		alert("Please select any product.")
	}		
});
</script>
		<?php 
		$session = Mage::getSingleton("core/session",  array("name"=>"frontend"));
$zip = $session->getData("zip");
		if(!isset($zip)){?>
<div id="popup_box">    <!-- OUR PopupBox DIV-->
    <h1>Enter a Zip Code</h1>
    <div class="popcon">
    
    <div class="col-lg-8 col-xs-10 col-lg-offset-1 pad0">
        <input type="text" name="popzip" class="inputnewseller" id="popzip" placeholder="Delivery Pincode"/>
        </div>
        <div class="col-lg-2 col-xs-2 pad0">
        <input type="button" class="inputngoseller"  value="Go" id="go"/>
    </div>
    <span class="poperrmsg"></span>
</div>
</div>
<div class="block blockui"></div>
<style type="text/css">

.inputnewseller{    display: block;
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.42857;
    color: #555;
    background-color: #FFF;
    background-image: none;
    border: 1px solid #CCC;
    box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.075) inset;
    transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
}
.inputngoseller{ border: medium none;
float: left;
height: 34px;
padding: 6px 12px;
background: rgb(216, 216, 216) none repeat scroll 0% 0%;
width: 100%;}
/* popup_box DIV-Styles*/
.blockui {
    background-color: #000;
    border: 1px solid;
    display: block;
    height: 100%;
    left: 0;
    margin: 0 auto;
    opacity: 0.5;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 10000;
} 
#popup_box {
    display:block; /* Hide the DIV */
    position:fixed;  
    _position:absolute; /* hack for internet explorer 6 */  
    height:160px;  
    width:420px;  
    background:#FFFFFF;  
    left: 36%;
    top: 190px;
    z-index:100000; /* Layering ( on-top of others), if you have lots of layers: I just maximized, you can change it yourself */
    margin-left: 15px;  
   
    /* additional features, can be omitted */
   
    padding:15px;  
    font-size:15px;  

   
}
.poperrmsg{color: rgb(185, 53, 53);
font-size: 12px;
text-align: center;
float: left;
width: 100%;
margin-top: 10px;}
#popup_box h1{font-size: 18px;margin: 25px 0;
color: #A4A4A4;
text-align: center;}

#container {
    background: #d2d2d2; /*Sample*/
    width:100%;
    height:100%;
}

a{ 
cursor: pointer; 
text-decoration:none; 
}

/* This is for the positioning of the Close Link */
#popupBoxClose {
    font-size:20px;  
    line-height:15px;  
    right:5px;  
    top:5px;  
    position:absolute;  
    color:#6fa5e2;  
    font-weight:500;      
}
</style>    


<script type="text/javascript">
jQuery(document).ready( function() {
	// When site loaded, load the Popupbox First
	loadPopupBox();

	jQuery('#popupBoxClose').click( function() {           
		unloadPopupBox();
	});
   
	jQuery('#container').click( function() {
		unloadPopupBox();
	});

	function unloadPopupBox() {    // TO Unload the Popupbox
		jQuery('#popup_box').fadeOut("slow");
		jQuery("#container").css({ // this is just for style       
			"opacity": "1" 
		});
	}   
   
	function loadPopupBox() {    // To Load the Popupbox
		jQuery('#popup_box').fadeIn("slow");
		jQuery("#container").css({ // this is just for style
			"opacity": "0.3" 
		});        
	}
	   jQuery(document).keypress(function(event) {
      var keycode = (event.keyCode ? event.keyCode : event.which);
      if (keycode == '13') {
        jQuery('#go').click();
      }
    });       
});

jQuery('#go').click(function(){
	var zip = jQuery('#popzip').val();
    var pass = jQuery('#popzip').val();
	var hasErr = 0;
	if(!zip){
		hasErr = 1;
		jQuery('.poperrmsg').html('Please enter your Pincode');
	}else{
		if(zip.length != 6){
			hasErr = 1;
			jQuery('.poperrmsg').html('Sorry enter a valid zip code');
		}
		if(!jQuery.isNumeric(zip)){
			hasErr = 1;
			jQuery('.poperrmsg').html('Sorry enter a valid zip code');
		}
	}
	if(hasErr == 0){
		var zip = jQuery('#zip_input').val(zip);
			jQuery('.block').removeClass('blockui');
			jQuery('#popup_box').css("display", "none");
			setsession(pass);	
			
	}
});
function setsession(pass){
	jQuery.ajax({
				url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'setsession.php'?>',
				type:'POST',
				data:{'zip':pass},
				success:function(d){
				//alert(d);
				jQuery('#search_by_zip').trigger( "click" );
				
				}
				}); 
	
}
</script>    
<?php }?>
	   <script type="text/javascript">
function selectqty(zipqty){
	if(jQuery('tr').hasClass('clickmetoselect') ){
		if(zipqty < 10){
		alert('If the order is above 10MT, we ship it free');
		}
	//$('li.show-more > a').addClass('selected');
		var popupSellerIdload= jQuery('.clickmetoselect1:first').val();
		jQuery('.selectvendor').removeClass('tick');
		jQuery('#button-'+popupSellerIdload).addClass('tick');
		jQuery('#button-'+popupSellerIdload).attr('disable','disable');
		jQuery('#radio-'+popupSellerIdload).attr('checked','checked');
		jQuery('#radio-'+popupSellerIdload).trigger( "click" ,{vendor:popupSellerIdload});
		jQuery('#nosellers').hide();
	}else{
		jQuery('#totalseller').html('');
		jQuery('.top-selname h4').text('-');
		jQuery('#nosellers').show();
		//alert( 'Sorry there are no sellers serving this locality right now - please check again in few days.' );
	}
}
var bod = 'body,html';
if(BrowserDetect.browser == 'Chrome'){
	bod = 'body';	
}
jQuery('#search_by_zip').click(function(){

   var zip = jQuery('#zip_input').val();
   var tp = jQuery('#menu1').text();
   if(tp == 'MT')
	{
		var zipqty = jQuery('.quantity').text();
	}else{
		var zipqty = jQuery('.estimate').text();
	}
	var cartcount = '<?php echo Mage::helper('checkout/cart')->getItemsCount(); ?>';
		 <?php 
			$quote = Mage::getSingleton('checkout/session')->getQuote();
			$cartItems = $quote->getAllVisibleItems();
			foreach ($cartItems as $item) {
				if($productZip == $item->getZipcode()){
					$productZip = $item->getZipcode();
				}else{
					$productZip = $item->getZipcode();
				}
			}
		 ?> 
		var zipvalidate = '<?php echo $productZip  ?>';
   var favorite = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite.push(jQuery(this).attr('data'));
	});
	var favorite1 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite1.push(jQuery(this).attr('data-val'));
	});  
	var hasErr = false;
	if(!zip){
		hasErr = true;
		jQuery('.errmsg').html('Please enter your Pincode');
		jQuery('.errmsg').show();
	}else if(cartcount == 0)
		  {
		      var hasErr = false;
				jQuery('.saddtocartbtn').css('background','#bd4931');
				jQuery('.sbuynowbtns').css('background','#bd4931');
		}else if(cartcount != '' || cartcount != null || cartcount != 'null'){
			 
			  if(zipvalidate != zip)
			  {
				  hasErr = true;
				 <?php $zipcodemsg =  Mage::getStoreConfig('configuration/configuration_cart_zipcode_validation/cartzipcode'); ?>
				 var zipcodemsg = '<?php echo $zipcodemsg ?>';
				 var finalmnsg =  zipcodemsg.replace('{{old_pincode}}',zipvalidate).replace('{{new_pincode}}',zip);
				 jQuery('.errmsg').show();
				 jQuery('.errmsg').text(finalmnsg);				 
				 jQuery('.sbuynowbtns').attr('disabled',true);
				 jQuery('.sbuynowbtns').css('background','#989898');
				 jQuery('.saddtocartbtns').attr('disabled',true);
				 jQuery('.saddtocartbtns').css('background','#989898');
				 jQuery('.selectvendor').attr('disabled',true);
				 jQuery('.box').attr('disabled',true);
				 //jQuery('#seller_choosen').css('display','block');
			  }
			  else
			  {
				var hasErr = false;
				jQuery('.saddtocartbtn').css('background','#bd4931');
				jQuery('.sbuynowbtns').css('background','#bd4931');
			  }
			  
	  }else{
		if(zip.length != 6){
			hasErr = true;
			jQuery('.errmsg').html('Sorry enter a valid Pincode');
			jQuery('.errmsg').show();
		}
		if(!jQuery.isNumeric(zip)){
			hasErr = true;
			jQuery('.errmsg').html('Sorry enter a valid Pincode');
			jQuery('.errmsg').show();
		}				
				
	}
	if(hasErr){
		jQuery('#zip_input').css('border','1px solid #ff0000');
	}else{			
	var favorite2 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
	   favorite2.push(jQuery(this).attr('control'));
	});
	var favorite3 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite3.push(jQuery(this).val());
	});
	var qtyNew = favorite2.join(", ");
	var prodNew = favorite3.join(", ");
	var size = favorite.join(", ");
	var prodqty = favorite1.join(", ");
	var brand = jQuery('input:radio[name=brand]:checked').val();
	jQuery('.spin-wrapper').css("display", "block");
	jQuery('.compare_brand').css("display", "none");
	jQuery.ajax({
					url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'steelseller.php'?>',
					type:'POST',
					data:{'brand':brand,'zip':zip,'size':size,'qty':prodqty,'tp':tp,'totalqty':zipqty, 'qtyNew':qtyNew, 'prodids':prodNew},
					success:function(d){	
					jQuery('.spin-wrapper').css("display", "none");	
					var p =jQuery('.select_seller');
					//jQuery("html, body").animate({scrollTop: jQuery('.select_seller').offset().top }, 1000);
					jQuery('.select_seller').show();
					jQuery('.select_seller').html(d);
					jQuery('#zip_input').css('border','1px solid #ccc');
					jQuery('.errmsg').hide();	
					jQuery('.errmsg_mysore').hide();						
					selectqty(zipqty);
					}
				});
	}
});
				
var urlbrand = <?php echo $brandurl; ?>;
if(urlbrand == 0){
    var first = jQuery('.list_enabled:first input').val();
}else{
	var first = urlbrand;
}
if(first != '' ){
	var diameter = <?php echo $usedAttributeValues ?>;
	var dataString = JSON.stringify(diameter);
	var tp = jQuery('#menu1').text();
	if(tp == 'MT')
	{
	   var zipqty = jQuery('.quantity').text();
	}else{
		var zipqty = jQuery('.estimate').text();
	}
	var favorite = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite.push(jQuery(this).attr('data'));
	});
	var favorite1 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite1.push(jQuery(this).attr('data-val'));
	});

	var favorite2 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite2.push(jQuery(this).val());
	});
	var favorite3 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite3.push(jQuery(this).attr('control'));
	});
	var diameter1 = favorite.join(", ");
	var fixedqty = favorite3.join(", ");
	var qty = favorite1.join(", ");
	var qtyNew = favorite2.join(", ");
    jQuery.ajax({
		url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'list.php'?>',
		type:'POST',
		data:{'brand':first,'dia':dataString,'dia1':diameter1,'selqty':qty,'tp':tp, 'qtyNew':qtyNew, 'fixed':fixedqty},
		success:function(d){
		//alert(d);
		jQuery('.list').html(d);								
		jQuery('#deal'+first).attr('checked', 'checked');
		jQuery('#search_by_zip').trigger( "click" );
		}
			}); 
}
jQuery(".brand_list").click(function(){
	var brand = jQuery('input:radio[name=brand]:checked').val();
	var diameter = <?php echo $usedAttributeValues ?>;
	var dataString = JSON.stringify(diameter);
	var tp = jQuery('#menu1').text();
	if(tp == 'MT'){
		var zipqty = jQuery('#tquantity').text();
	}else{
		var zipqty = jQuery('#testimate').text();
	}
	var favorite = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite.push(jQuery(this).attr('data'));
	});
	var favorite1 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite1.push(jQuery(this).attr('data-val'));
	});

	var favorite2 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite2.push(jQuery(this).val());
	});
	var favorite3 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite3.push(jQuery(this).attr('control'));
	});
	var diameter1 = favorite.join(", ");
	var fixedqty = favorite3.join(", ");
	var qty = favorite1.join(", ");
	var qtyNew = favorite2.join(", ");
	var zip = jQuery('#zip_input').val();
	//alert(diameter1+'prodNew'+fixedqty+'qtyNew'+qty+'size'+qtyNew+'xiptotal'+zipqty);
	if(tp =='MT'){
		jQuery.ajax({
						url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'list.php'?>',
						type:'POST',
						data:{'brand':brand,'dia':dataString,'dia1':diameter1,'selqty':qty,'tp':tp, 'qtyNew':qtyNew, 'fixed':fixedqty},
						success:function(d){
						jQuery('.list').html(d);
						if(zip != ''){
						sellerpricebrand(zip,diameter1,fixedqty,qty,qtyNew,zipqty);	
						//return false;
						}					
						}
		});
	}else if(tp =='Bundle'){
		jQuery.ajax({
				url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'listtype.php'?>',
				type:'POST',
				data:{'brand':brand,'dia':dataString,'dia1':diameter1,'selqty':qty,'tp':tp, 'qtyNew':qtyNew, 'fixed':fixedqty},
				success:function(d){
				jQuery('.list').html(d);
				var zip = jQuery('#zip_input').val();
				if(zip != ''){
					//alert(zip);
				sellerpricebrand(zip,diameter1,fixedqty,qty,qtyNew,zipqty);
				}	
				}
			});
	  }else{
	   jQuery.ajax({
			url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'listkg.php'?>',
			type:'POST',
			data:{'brand':brand,'dia':dataString,'dia1':diameter1,'selqty':qty,'tp':tp, 'qtyNew':qtyNew, 'fixed':fixedqty},
			success:function(d){
			jQuery('.list').html(d);
			var zip = jQuery('#zip_input').val();
			if(zip != ''){
				//alert(zip);
			sellerpricebrand(zip,diameter1,fixedqty,qty,qtyNew,zipqty);
			}	
			}
		});
	}
});
function sellerpricebrand(zip,diameter1,fixedqty,qty,qtyNew,zipqty){
	var brand = jQuery('input:radio[name=brand]:checked').val();
	/*var favorite = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite.push(jQuery(this).attr('data'));
	});
	var favorite1 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite1.push(jQuery(this).attr('data-val'));
	});  
	var favorite2 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
	   favorite2.push(jQuery(this).attr('control'));
	});
	var favorite3 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite3.push(jQuery(this).val());
	});
	alert(qtyNew);*/
	var qtyNew1 = fixedqty;
	var prodNew = qtyNew;
	var size = diameter1;
	var prodqty = qty;
	var tp = jQuery('#menu1').text();
	jQuery('.spin-wrapper').css("display", "block");
	//alert(prodqty+'prodNew'+prodNew+'qtyNew'+size+'size'+prodqty+'xiptotal'+qtyNew1);
	jQuery.ajax({
		url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'steelseller.php'?>',
		type:'POST',
		data:{'brand':brand,'zip':zip,'size':size,'qty':prodqty,'tp':tp,'totalqty':zipqty,'qtyNew':qtyNew1, 'prodids':prodNew},
		success:function(d){
			var vendorrr = jQuery('input:radio[name=vendor]:checked').val();
			jQuery('#deal'+brand).prop('checked', true);
			jQuery('.select_seller').show();
			jQuery('.select_seller').html(d);
			if(jQuery('tr').hasClass('clickmetoselect') ){
				jQuery('#nosellers').hide();
				}else{
						  jQuery('#totalseller').html('');
						  jQuery('.compare_brand').hide();
						  jQuery('.slrmsg').hide();
						  jQuery('.top-selname h4').text('-');
						  jQuery('.spin-wrapper').css("display", "none");
						  jQuery('#nosellers').show();
						  //jQuery('.switch_type').text('Sorry there are no sellers serving this locality right now - please try different zip code in Check Availability.');
				}
				//alert(d);
				jQuery.each(jQuery(".clickmetoselect1"), function(){  
					var vendor_list = 	jQuery(this).val();
					
						if(vendor_list == vendorrr && prodqty != ''){
							//alert(vendor_list+'--'+vendorrr);
							if(typeof(vendorrr)  != "undefined") {
								//alert('fasdas');
														 setTimeout(function(){
										   jQuery('.selectvendor').removeClass('tick');
										jQuery('#button-'+vendorrr).addClass('tick');
										jQuery('#button-'+vendorrr).attr('disable','disable');
										jQuery('#radio-'+vendorrr).attr('checked','checked');
										jQuery('#radio-'+vendorrr).trigger( "click");
										 //jQuery('.spin-wrapper').css("display", "none");
										}, 3000);
										jQuery('.compare_brand').css("display", "block");
										}
										
							}else{
								//alert('list');
										var popupSellerIdload= jQuery('.clickmetoselect1:first').val();
										
										jQuery('.selectvendor').removeClass('tick');
										jQuery('#button-'+popupSellerIdload).addClass('tick');
										jQuery('#button-'+popupSellerIdload).attr('disable','disable');
										jQuery('#radio-'+popupSellerIdload).attr('checked','checked');
										jQuery('#radio-'+popupSellerIdload).trigger( "click");
										//jQuery('.spin-wrapper').css("display", "none");
					}				
            });
			 
			
			}
			}); 
}	
  </script>
   <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script type="text/javascript">
function showDialog(){
jQuery("#dialog").dialog({	
	resizable: false,
	modal: true,
	dialogClass: "dialog",
	height: 600,
	width: 900,
	draggable: false,
});

	// Pass data to compare brand popup
	var favoritePopup = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favoritePopup.push(jQuery(this).attr('data'));
	});
	var favoritePopup1 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favoritePopup1.push(jQuery(this).attr('data-val'));
	});


	var favorite3 = [];
	jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
		favorite3.push(jQuery(this).attr('control'));
	});

	var fixedqty = favorite3.join(", ");
	var selectedSeller = jQuery('input:radio[name=vendor]:checked').val();
	var zip = jQuery('#zip_input').val();
	var sizePopup = favoritePopup.join(", ");
	var prodqty = favoritePopup1.join(", ");
	var brandPopup = jQuery('input:radio[name=brand]:checked').val();

	jQuery.ajax({
		url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'brandcomparision_popup.php'?>',
		type:'POST',
		data:{'brand':brandPopup,'zip':zip,'size':sizePopup,'qty':prodqty, 'selected_seller':selectedSeller, 'fixed':fixedqty},
		success:function(d){
			//alert(d);
			 jQuery('.compare_area').html(d);
		}
	});	
	}
	jQuery(document).ready(function() {
	jQuery('#myCarousel').carousel({
		pause: true,
    	interval: false
	})
});

function processConfirmData(popupSellerId,popupBrandId,popupProductId,popupQty,popupFixedQty)
{
	//product filter
	jQuery('#deal'+popupBrandId).prop('checked', true);
	//alert(popupFixedQty);
	// pincode go action									
	 jQuery('.errmsg').html('');
		   var zip = jQuery('#zip_input').val();
		   var favorite = [];
            jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
                favorite.push(jQuery(this).attr('data'));
            });
			var favorite1 = [];
            jQuery.each(jQuery("input[name='pid[]']:checked"), function(){            
                favorite1.push(jQuery(this).attr('data-val'));
            });
		   var hasErr = false;
					if(!zip){
						hasErr = true;
						jQuery('.errmsg').html('Please enter your Pincode');
					}else{
						if(zip.length != 6){
							hasErr = true;
							jQuery('.errmsg').html('Sorry enter a valid Pincode');
						}
						if(!jQuery.isNumeric(zip)){
							hasErr = true;
							jQuery('.errmsg').html('Sorry enter a valid Pincode');
						}
						if(favorite == ''){
							hasErr = true;
							jQuery('.errmsg').html('Please Choose any Type');
						}
					}
					if(hasErr){
						jQuery('#zip_input').css('border','1px solid #ff0000');
					}else{
		   
			//alert(favorite);
			var size = popupProductId;
			var prodqty = popupQty;
			var brand = popupBrandId;
			 var tp = jQuery('#menu1').text();
			  if(tp == 'MT')
		   {
			   var zipqty = jQuery('.quantity').text();
		   }else{
			    var zipqty = jQuery('.estimate').text();
		   }
            //alert(zip+"deee"+prodqty+"My favourite sports are: " + favorite.join(", "));
			
		   		jQuery.ajax({
							url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'steelseller.php'?>',
							type:'POST',
							data:{'brand':brand,'zip':zip,'size':size,'qty':prodqty,'tp':tp,'totalqty':zipqty},
							success:function(d){
								//alert(d);
								jQuery('.select_seller').show();
						jQuery('.select_seller').html(d); 
						jQuery('.spin-wrapper').css("display", "block");
							}
						});
			    }
				  /*var qtyyy = popupQty;
				  var branddd = popupBrandId;	  
				  var diameterrr = popupProductId;
				  var vendorrr = popupSellerId;
				//  var tp = jQuery('#menu1').text();
				  jQuery.ajax({
										url:'<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).'selectseller.php'?>',
										type:'POST',
										data:{'brand':branddd,'dia':diameterrr,'vendor':vendorrr,'selqty':qtyyy,'tp':tp,'fixed':popupFixedQty},
										success:function(d){
											
											jQuery('.list').html(d);
											
										}
									});
				 */
				 
				 setTimeout(function(){
					 jQuery('.selectvendor').removeClass('tick');
					jQuery('#button-'+popupSellerId).addClass('tick');
					jQuery('#button-'+popupSellerId).attr('disable','disable');
					jQuery('#radio-'+popupSellerId).attr('checked','checked');
						jQuery('#radio-'+popupSellerId).trigger( "click" ,{vendor:popupSellerId});
					  jQuery('.spin-wrapper').css("display", "none");
					}, 3000);
					jQuery('html, body').animate({
						   scrollTop: jQuery(".cbheading").offset().top
						}, 800);
					              
	
}
</script>
